<!-- TODO: Refactor to move Ruby code to Model/ Controller/Helper as appropriate -->
<head>
<title><%= @header = @vendor.name %> %></title>
</head>
<div class="container">
<body class="market-view">


<h3><%= @vendor.name %></h3>

<h2>Product list</h2>

<table class="product-index-table">

<% @product_list.each do |product| %>
<tr>
  <td><b><%= product[:name] %> </b></td>
  <td><%= link_to("Edit ", edit_vendor_product_path(product[:vendor_id], product[:id]))%> </td>
  <td><%= link_to("Delete", vendor_product_path(product[:vendor_id], product[:id]), method: :delete, data: { confirm: "Are you sure you want to delete this product?"}) %></td>
  <td><%= link_to("New Sale", new_vendor_product_sale_path(@vendor.id, product.id))%></td>
  <!--  Alternative Syntax -->
  <%# link_to("Create a sale", [@vendor, @product]) %>
<% end %>
</tr>
</table>

<p><%= link_to("New Product", new_vendor_product_path) %></p>

<h3>Sales</h3>

<p>Current Month's Sales:
<% total_month_sales = 0 %>
<% @sales.each do |sale| %>
  <% if sale[:purchase_time].strftime("%Y%m") == Time.now.strftime("%Y%m") %>
    <% total_month_sales += sale[:amount] %>
  <% end %>
<% end %>

<% if total_month_sales != 0.to_i %>
  $<%= add_decimal(total_month_sales)%></p>
<% else %>
  <%= " None"%></p>
<% end %>

<p>Total Sales:
<% total_sales = 0 %>
<% @sales.each do |sale| %>
  <% total_sales += sale[:amount] %>
<% end %>

<% if total_sales != 0.to_i %>
  $<%= add_decimal(total_sales)%></p>
<% else %>
  <%= " N/A"%></p>
<% end %>


<h3><%= link_to("View All Sales by Product", vendor_sales_path) %></h3>
